"0","knitr::opts_chunk$set(echo = FALSE)"
"0","library(ggeffects)"
"0","library(tidyverse)"
"0","library(here)"
"0","library(ggsci)"
"0","library(gridExtra)"
"0","library(lme4)"
"0","library(lmerTest)"
"0","library(emmeans)"
"0","library(plot3D)"
"0","library(egg)"
"0","library(grid)"
"0","library(cowplot)"
"0","source(here(""R/find_peakvalley.r""))"
"0",""
"0","# read in roya data and calculate infection level"
"0","roya <- readRDS(here(""data/roya_uniqueplants_20250817.rds"")) %>%"
"0","  mutate(plantgen = if_else(plantnum ==0, ""original"", ""new plant""))"
"0",""
"0","# missing dates"
"0","first.date <- min(roya$date)"
"0","last.date <- max(roya$date)"
"0","fill.dates <- data.frame(date = zoo::as.yearmon("
"0","  first.date + seq(0, (last.date-first.date)*12)/12)"
"0","  )"
"0",""
"0","# average roya and hojas"
"0","roya_clean <- roya %>% "
"0","  filter(!(is.na(roya)|is.na(hojas)|hojas==0)) %>%"
"0","  mutate(infect = roya/hojas) %>% filter(infect < 1)"
"0",""
"0","roya_avg <- roya_clean %>% "
"0","  bind_rows(roya_clean %>% mutate(plantgen = ""all"")) %>%"
"0","  group_by(date, plantgen) %>% "
"0","  summarize(n = n(), roya_mn = exp(mean(log(roya+1)))-1, "
"0","            roya_upr = exp(mean(log(roya+1)) + (sd(log(roya+1))/sqrt(n)))-1,"
"0","            roya_lwr = exp(mean(log(roya+1)) - (sd(log(roya+1))/sqrt(n)))-1,"
"0","            hoja_mn = exp(mean(log(hojas))),"
"0","            hoja_upr = exp(mean(log(hojas)) + (sd(log(hojas))/sqrt(n))),"
"0","            hoja_lwr = exp(mean(log(hojas)) - (sd(log(hojas))/sqrt(n))),"
"0","            inf_mn = exp(mean(log(infect + 0.001)))-0.001,"
"0","            inf_upr = exp(mean(log(infect + 0.001)) + (sd(log(infect + 0.001))/sqrt(n)))-0.001,"
"0","            inf_lwr = exp(mean(log(infect + 0.001)) - (sd(log(infect + 0.001))/sqrt(n)))-0.001"
"0","            ) %>%"
"0","  ungroup()"
"2","[38;5;232m`summarise()` has grouped output by 'date'. You can override using the
`.groups` argument.[39m
"
"0","# # rain"
"0","# rain <- readRDS(here(""Data/rain_202010.rds"")) %>% filter(date >= ""Jan 2013"")"
"0","# rain.ann <- read.csv(here(""Data/Raw Data/annual_rain_202010.csv"")) %>%"
"0","#   filter(year < 2020)"
"0","# "
"0","# rain.month.avg <- rain %>% mutate(month = as.numeric(format(date, ""%m""))) %>%"
"0","#   group_by(month) %>% summarize(rain.avg = mean(rainmm, na.rm=TRUE)) %>% ungroup()"
"0","# "
"0","# rain2 <- rain %>% mutate(month = as.numeric(format(date, ""%m""))) %>%"
"0","#   left_join(rain.month.avg, by = ""month"") %>% "
"0","#   mutate(rain.dev = rainmm - rain.avg)"
"0",""
"0","# missing dates"
"0","first.date <- min(roya$date)"
"0","last.date <- max(roya$date)"
"0","fill.dates <- data.frame(date = zoo::as.yearmon("
"0","  first.date + seq(0, (last.date-first.date)*12)/12)"
"0","  )"
